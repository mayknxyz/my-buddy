---
interface BreadcrumbSegment {
  label: string;
  href: string;
}

interface Props {
  segments: BreadcrumbSegment[];
}

const { segments } = Astro.props;
const hasMiddle = segments.length > 3;
const first = segments[0];
const last = segments[segments.length - 1];
const middle = segments.slice(1, -1);
---

{segments.length > 0 && (
  <nav aria-label="Breadcrumb" class="mb-4">
    <ol class="flex flex-wrap items-center gap-1 text-sm text-[var(--color-text-muted)]">
      {/* First segment -- always visible */}
      <li>
        <a
          href={first.href}
          class="text-[var(--color-primary)] hover:text-[var(--color-primary-hover)] hover:underline"
          data-focusable
          tabindex="0"
        >
          {first.label}
        </a>
      </li>

      {/* Middle segments -- hidden on mobile when chain is deep */}
      {middle.map((seg) => (
        <>
          <li class:list={[hasMiddle && 'hidden sm:list-item']}>
            <span class="text-[var(--color-text-muted)]">/</span>
          </li>
          <li class:list={[hasMiddle && 'hidden sm:list-item']}>
            <a
              href={seg.href}
              class="text-[var(--color-primary)] hover:text-[var(--color-primary-hover)] hover:underline"
              data-focusable
              tabindex="0"
            >
              {seg.label}
            </a>
          </li>
        </>
      ))}

      {/* Ellipsis -- visible only on small screens when middle segments are hidden */}
      {hasMiddle && (
        <>
          <li class="sm:hidden">
            <span class="text-[var(--color-text-muted)]">/</span>
          </li>
          <li class="sm:hidden">
            <span class="text-[var(--color-text-muted)]">...</span>
          </li>
        </>
      )}

      {/* Last segment -- always visible, plain text (current page) */}
      {segments.length > 1 && (
        <>
          <li>
            <span class="text-[var(--color-text-muted)]">/</span>
          </li>
          <li>
            <span class="font-medium text-[var(--color-text)] truncate">{last.label}</span>
          </li>
        </>
      )}
    </ol>
  </nav>
)}
