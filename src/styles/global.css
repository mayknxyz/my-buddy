/**
 * Global stylesheet for my-buddy.
 * Dark theme with 6 accent color variants, WCAG AA focus rings,
 * wiki-link styles, and prose overrides via Tailwind CSS v4's @theme directive.
 */
@import "tailwindcss";
@plugin "@tailwindcss/typography";

/* ---------------------------------------------------------------------------
 * Theme tokens — dark-only design system
 * WHY: Single dark theme keeps the system simple. Accent colors provide
 * enough personality per-instance without a full light/dark toggle.
 * ------------------------------------------------------------------------- */
@theme {
  /* Surface palette */
  --color-surface-0: oklch(0.145 0.005 285);
  --color-surface-1: oklch(0.18 0.005 285);
  --color-surface-2: oklch(0.22 0.005 285);
  --color-surface-3: oklch(0.28 0.005 285);

  /* Text palette */
  --color-text-primary: oklch(0.95 0.005 285);
  --color-text-secondary: oklch(0.7 0.01 285);
  /* WHY: bumped from 0.5 to 0.6 for WCAG AA 4.5:1 contrast against surface-0 */
  --color-text-muted: oklch(0.6 0.01 285);

  /* Border */
  --color-border: oklch(0.3 0.005 285);
  --color-border-hover: oklch(0.4 0.005 285);

  /* Z-index scale */
  --z-dropdown: 10;
  --z-sticky: 20;
  --z-sidebar: 50;
  --z-modal: 100;
  --z-overlay: 200;
  --z-toast: 300;

  /* Status colors */
  --color-success: oklch(0.72 0.17 155);
  --color-warning: oklch(0.8 0.15 85);
  --color-danger: oklch(0.65 0.2 25);
  --color-info: oklch(0.7 0.15 250);
}

/* ---------------------------------------------------------------------------
 * Accent color system — selected via [data-accent] on <html>
 * WHY: Each instance picks an accent in buddy.config.ts. The attribute
 * selector avoids JS runtime — it's set once in the HTML shell.
 * ------------------------------------------------------------------------- */
:root,
[data-accent="indigo"] {
  --color-accent: oklch(0.65 0.18 270);
  --color-accent-hover: oklch(0.58 0.2 270);
  --color-accent-subtle: oklch(0.25 0.06 270);
}

[data-accent="blue"] {
  --color-accent: oklch(0.65 0.18 245);
  --color-accent-hover: oklch(0.58 0.2 245);
  --color-accent-subtle: oklch(0.25 0.06 245);
}

[data-accent="emerald"] {
  --color-accent: oklch(0.7 0.17 160);
  --color-accent-hover: oklch(0.63 0.19 160);
  --color-accent-subtle: oklch(0.25 0.06 160);
}

[data-accent="amber"] {
  --color-accent: oklch(0.8 0.15 85);
  --color-accent-hover: oklch(0.73 0.17 85);
  --color-accent-subtle: oklch(0.25 0.06 85);
}

[data-accent="rose"] {
  --color-accent: oklch(0.65 0.2 15);
  --color-accent-hover: oklch(0.58 0.22 15);
  --color-accent-subtle: oklch(0.25 0.06 15);
}

[data-accent="violet"] {
  --color-accent: oklch(0.65 0.2 300);
  --color-accent-hover: oklch(0.58 0.22 300);
  --color-accent-subtle: oklch(0.25 0.06 300);
}

/* ---------------------------------------------------------------------------
 * Base styles
 * ------------------------------------------------------------------------- */
html {
  background-color: var(--color-surface-0);
  color: var(--color-text-primary);
  font-family: system-ui, -apple-system, sans-serif;
}

/* WCAG AA focus rings — 3:1 contrast against dark surfaces */
:focus-visible {
  outline: 2px solid var(--color-accent);
  outline-offset: 2px;
}

/* ---------------------------------------------------------------------------
 * Wiki-link styles
 * ------------------------------------------------------------------------- */
a.wiki-link {
  color: var(--color-accent);
  text-decoration: underline;
  text-decoration-color: var(--color-accent-subtle);
  text-underline-offset: 2px;
}

a.wiki-link:hover {
  text-decoration-color: var(--color-accent);
}

span.wiki-link-broken {
  color: var(--color-text-muted);
  text-decoration: line-through;
  cursor: not-allowed;
}

/* ---------------------------------------------------------------------------
 * Prose overrides — Tailwind Typography on dark background
 * ------------------------------------------------------------------------- */
.prose {
  --tw-prose-body: var(--color-text-primary);
  --tw-prose-headings: var(--color-text-primary);
  --tw-prose-links: var(--color-accent);
  --tw-prose-bold: var(--color-text-primary);
  --tw-prose-counters: var(--color-text-secondary);
  --tw-prose-bullets: var(--color-text-muted);
  --tw-prose-hr: var(--color-border);
  --tw-prose-quotes: var(--color-text-secondary);
  --tw-prose-quote-borders: var(--color-accent-subtle);
  --tw-prose-code: var(--color-text-primary);
  --tw-prose-pre-code: var(--color-text-primary);
  --tw-prose-pre-bg: var(--color-surface-1);
  --tw-prose-th-borders: var(--color-border);
  --tw-prose-td-borders: var(--color-border);
}

/* ---------------------------------------------------------------------------
 * Navigable list items — keyboard-selectable rows
 * WHY: j/k navigation highlights the current item. The [data-selected]
 * attribute is toggled by keyboard.ts at runtime.
 * ------------------------------------------------------------------------- */
[data-navigable] {
  transition: background-color 0.1s ease;
}

[data-navigable][data-selected] {
  background-color: var(--color-surface-2);
}

#sidebar nav {
  scrollbar-width: none; /* Firefox */
}

#sidebar nav::-webkit-scrollbar {
  display: none; /* Chrome, Safari, Edge */
}

/* ---------------------------------------------------------------------------
 * Sidebar — layout offset and compact mode
 * WHY: The content wrapper uses margin-left to make room for the sidebar.
 * Compact mode is applied via [data-sidebar-compact] on <html>, set by an
 * inline script before paint to prevent layout shift (FOUC).
 * ------------------------------------------------------------------------- */
@media (min-width: 1024px) {
  .sidebar-offset {
    margin-left: 14rem; /* w-56 */
  }

  [data-sidebar-compact] .sidebar-offset {
    margin-left: 3.5rem; /* w-14 */
  }

  [data-sidebar-compact] #sidebar {
    width: 3.5rem; /* w-14 */
  }

  [data-sidebar-compact] [data-sidebar-label],
  [data-sidebar-compact] [data-sidebar-heading] {
    display: none;
  }

  [data-sidebar-compact] #sidebar nav a {
    justify-content: center;
    padding-inline: 0;
  }
}
